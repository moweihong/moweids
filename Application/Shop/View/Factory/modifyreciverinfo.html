<extend name="Layouts:pop" />
<block name="head_css">
<link href="__CSS__/seller.css" rel="stylesheet" type="text/css">
<style type="text/css">
    .layui-layer-tips .layui-layer-content{top:-10px;}
    .refund-pop-cont .list{ margin-left:-50px;}
</style>
</block>
<block name="content">
<div class="modify-reciver-pop">
	<form action="javascript:void(0);" id="form" method="post" autocomplete="off">
        <input type="hidden" name="order_id" value="<?php echo $_GET['order_id'];?>"/>
        <div class="refund-pop-cont">
            <p class="prompt-k">原地址：
                <?php echo $order_info['extend_order_common']['reciver_info']['address'];?>，
                <?php if (isset($order_info['extend_order_common']['reciver_info']['zip_code'])){
                    echo $order_info['extend_order_common']['reciver_info']['zip_code'].',';}
                ?>
                <?php echo $order_info['extend_order_common']['reciver_name'];?>，
                <?php echo $order_info['extend_order_common']['reciver_info']['phone'];?></p>
            <p class="mt10 ml5 fs14 cor-black">新地址：</p>
            <ul class="list">
                <li class="cf">
                    <label class="handle"><em class="cor-red">*</em>联系地址：</label>
                    <select id="cmbProvince" name="reciver_province_id" class="js-province" style="width:100px">
                        <option value="0">选择省份</option>
                    </select>
                    <select id="cmbCity" class="ml10 js-city" style="width:100px">
                        <option value="0">选择城市</option>
                    </select>
                    <select id="cmbArea" class="ml10 js-area" style="width:100px">
                        <option value="0">选择地区</option>
                    </select>
                    <span class="ml5 cor-9">(提醒：修改收货地址可能导致您的邮费变动)</span>
                </li>
                <li class="cf">
                    <label class="handle" for="address"><em class="cor-red">*</em>详细地址：</label>
                    <div class="rel">
                        <input type="text" id="address" name="address" class="text" style="width:570px;" placeholder="请填写详细地址" maxlength="80" required />
                        <span show="address.check" class="error-msg">
                            <em class="errow-arrow"></em>
                            详细地址不能为空
                        </span>
                    </div>
                </li>
                <li class="cf">
                     <label class="handle" for="postcode">邮编：</label>
                    <input type="text" id="postcode" name="zip_code" class="text js-number" placeholder="请填写邮编" maxlength="20" />
                </li>
                <li class="cf">
                    <label class="handle" for="consignee"><em class="cor-red">*</em>收货人：</label>
                    <div class="rel">
                        <input type="text" id="consignee " name="reciver_name" class="text" placeholder="请填写收货人" maxlength="80" required />
                        <span show="reciver_name.check" class="error-msg">
                            <em class="errow-arrow"></em>
                            收货人不能为空
                        </span>
                    </div>
                </li>
                <li class="cf">
                    <label class="handle" for="tel"><em class="cor-red">*</em>手机号码：</label>
                    <div class="rel">
                        <input type="text" id="tel" name="mob_phone" class="text js-number" value="" placeholder="请填写手机号码" maxlength="11" required />
                        <span show="mob_phone.check" class="error-msg">
                            <em class="errow-arrow"></em>
                            手机号码不能为空
                        </span>
                    </div>
                </li>
                <li class="cf">
                    <label class="handle">联系电话：</label>
                    <input type="text" class="text js-codes js-number" placeholder="区号" style="width:75px;" maxlength="8" />
                    <span class="cor-gray mr5 ml5">—</span>
                    <input type="text" class="text js-phone js-number" placeholder="请填写座机号" style="width:200px;" maxlength="10" />
                </li>
            </ul>
        </div>
        <p class="pop-btn-control">
            <button class="btn btn-blue ml100 js-submitBtn">提交</button>
        </p>
    </form>
</div>
</block>

<block name="my_js">
<script type="text/javascript">
(function($){
	define("s/modifyReciverInfo",function(require, exports, module){
		require("jquery/layer");
		require("jquery/form");
		var manage = require("com/manage");
		var param = manage.getParam();
		var Module = {
			init: function(){
				var form = $("#form").form(),
					index = parent.layer.getFrameIndex(window.name);
				parent.layer.iframeAuto(index);
				/*
				 * 城市三级联动
				 * */
				seajs.use("com/adarray", function() {
					addressInit("cmbProvince", "cmbCity", "cmbArea");
				});
				/*
				 *确认
				 */
				$(".modify-reciver-pop").on("click", ".js-submitBtn", function(){
					if(!form.valid()) return false;
					if($("#cmbArea").val() == 0){
						$.wrongMsg("请选择联系地址");
						return;
					}
					if(!$.isTelephone($.trim($("#tel").val()))){
						$.wrongMsg("请填写正确的手机号码");
						return;
					}
					var province = $("#cmbProvince option:selected").text(),
                        city = $("#cmbCity option:selected").text(),
                        area = $("#cmbArea option:selected").text(),
                        area_info = province + city + area,
                        phone_codes = $.trim($(".js-codes").val()),
						phone_num = $.trim($(".js-phone").val()),
						data = $("#form").serialize();
					data = manage.serializeJson(data);
                    data.area_info = area_info;
					data.tel_phone = phone_codes + "-" + phone_num;
					var pid = layer.load(360);
					manage.ajax({
						url: gConfig.apiurl + "/shop/Factory/saveReciverInfo",
						data: data,
						success: function(result){
							layer.close(pid);
							var resultText = result.resultText || {};
							if(result.code == 1){
								$.wrongMsg(resultText.message || "操作成功", 1);
                                parent.layer.close(pid);
							}else{
								$.wrongTip($(".js-submitBtn"), resultText.message || "操作失败");
							}
						},
						error: function(){
                            parent.layer.close(pid);
						}
					});
				});
			}
		};
		module.exports = Module;
	});
	seajs.use("s/modifyReciverInfo", function(module){
		module.init();
	});
})($);
</script>
</block>
</body>
</html>